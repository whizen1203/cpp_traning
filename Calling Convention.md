## 함수 호출 규약(Calling Convention, 호출 규약) : 함수를 호출하는 것에 대한 약속.

### 종류 구분 법 
- 인자 전달 순서 ( 왼쪽 인자 -> 오른쪽 인자 or 오른쪽 인자 -> 왼쪽 인자 )
- 인자 전달 방법 ( 스택 or 레지스터 ) 
- Stack Frame을 정리하는 방법 ( 함수 호출자[caller] or 함수 피호출자[callee]


### Stack Frame(스택 프레임) : 함수의 호출 과정에서 호출되는 함수를 사용하기 위해 할당되는 Stack의 공간.
프로그램이 실행되면 가장 먼저 Main 함수의 Stack Frame을 할당되며, Main함수가 A 함수를 호출하면서 스택의 ebp 레지스터 값을 push한다. 
push된 ebp 레지스터를 기준으로 스택 프레임을 구분한다.

**함수를 호출 시 매개변수, 함수가 종료될 때, 복귀할 명령어의 주소(return address), 이전 Stack Frame의 EBP값을 저장하고, 해당 함수의 지역변수를 저장하기 위한 공간을 할당한다.**

### 함수 호출시 스택 변화
main() 함수에서 test(1,2); 로 함수를 호출 하였을 때 스택의 변화. 

![img1](https://ifh.cc/g/oh0WYF.jpg)

(cdecl 기준), 매개변수 2와 1을 스택 메모리에 담고 eip레지스터(test함수 이후 실행할 코드의 주소)를 백업합니다. 그 후 ebp 레지스터의 값을 백업한다.


### 주요 특징 : 
1. 인자 전달 방식 : 함수에 전달되는 인자들이 어떤 순서로 스택에 푸시되는지를 결정한다. 예를 들면, 어떤 규약에서는 처음 인자가 먼저 푸시되고, 어떤 규약에서는 마지막 인자가 먼저 푸시된다.
2. 스택 정리 책임 : 함수 호출 후 스택에서 인자를 제거하는 책임이 호출자에게 있는지, 아니면 피호출 함수에게 있는지를 결정한다.
3. 레지스터 사용 : 어떤 레지스터가 함수 호출 도중에 값을 저장하는 데 사용되는지, 그리고 어떤 레지스터가 함수의 반환 값에 사용되는지를 결정한다.


### 주요 호출 규약 : 

1. cdecl : C 언어에서 흔히 사용되는 호출 규약. 인자들은 오른쪽에서 왼쪽으로 스택에 푸시되며, 호출자가 스택 정리의 책임을 갖는다.
- 인자 전달 순서 : 가장 오른쪽 인자 -> 가장 왼쪽 인자
- 인자 전달 방법 : 스택 메모리를 이용한다.
- 스택  프레임 (Stack Frame) 정리 : Caller(호출자)가 스택 프레임을 정리한다.
- 가변 인자 사용여부 : 가변인자(printf 처럼 매개변수의 개수가 정해지지 않는 함수) 사용 가능

2. stdcall : Win32 API에서 주로 사용되는 호출 규약. cdecl과 비슷하지만, **스택 정리의 책임이 피호출 함수에게 있다.**
- 인자 전달 순서 : 가장 오른쪽 인자 -> 가장 왼쪽 인자
- 인자 전달 방법 : 스택 메모리를 이용한다.
- 스택  프레임 (Stack Frame) 정리 : Callee(피호출자)가 스택 프레임을 정리한다.
- 가변 인자 사용여부 : 가변인자 사용 불가능

3. fastcall : 몇몇 인자들을 레지스터를 통해 전달하는 방식의 호출 규약. 따라서 함수 호출이 빠를 수 있지만, 사용 가능한 레지스터의 수가 제한적이기 때문에 모든 인자를 레지스터로 전달할 수는 없다.
- 인자 전달 순서 : 가장 오른쪽 인자 -> 가장 왼쪽 인자
- 인자 전달 방법 : EDX, ECX 레지스터를 이용하며 3개의 매개변수 부터는 스택을 사용한다.
- 스택  프레임 (Stack Frame) 정리 : Callee(피호출자)가 스택 프레임을 정리한다.
- 가변 인자 사용여부 : 가변인자 사용 불가능

4. thiscall : C++ 멤버 함수에서 사용되는 호출 규약. 객체의 포인터 (this 포인터)가 레지스터를 통해 전달됨.
- 인자 전달 순서 : 가장 오른쪽 인자 -> 가장 왼쪽 인자
- 인자 전달 방법 : 첫번째 레지스터(ECX 레지스터)를 이용하며 나머지 매개변수들은 스택을 사용한다.
- 스택  프레임 (Stack Frame) 정리 : Callee(피호출자)가 스택 프레임을 정리한다.
- 가변 인자 사용여부 : 가변인자 사용 불가능




